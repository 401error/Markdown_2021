
# Redis分布式锁

## 实现原理
* 因为单机的应用能够使用jvm的并发JUC来实现请求打到一台机器上时，能够在多线程情况下，能够锁住共享的资源
* 但是在集群部署的时候，无法做到两台机器能够锁住同一个共享变量，所以我们需要一个全局的标示来指导加锁，和释放锁
* 主流的分布式锁有，基于数据库，基于redis,基于zookeeper
  

## 怎么做
* 加锁时，往redis里加入唯一的key，一定要使用先设置时间，再添加数据的方式，达到原子性，防止先设置值，节点挂了，没有过期时间
* * SET KEY unique_key NX PX 30000
* 释放锁 ，也需要使用原子操作，也就是使用类似LUA脚本之类的，

尚存在的问题
* 如果过期时间内，由于网络等问题，加锁的机器没有完成事情，但锁已经失效，其他机器拿到了锁，导致并发问题。
* 如果redis是集群模式，当机器设置的master节点挂了，可能锁就丢失。

问题解决思路
  