# 数据库索引



定义：辅助数据结构，能够快速查找数据，而不用遍历所有数据

#### 索引的好处？

1. 通过创建索引,**可以在查询的过程中,提高系统的性能**；
2. 通过创建唯一性索引,可以保证数据库表中每一行数据的唯一性；
3. 在使用分组和排序子句进行数据检索时,可以减少查询中分组和排序的时间；

#### 索引的坏处？

1. **创建索引和维护索引要耗费时间**,而且时间随着数据量的增加而增大；
2. 索引需要占用物理空间,如果要建立聚簇索引,所需要的空间会更大；
3. 在对表中的数据进行增加删除和修改时需要耗费较多的时间,因为索引也要动态地维护；

#### 索引分类

* 依据**索引的顺序和数据库的物理存储顺序是否相同**，索引分为两类

  * 聚簇索引
    * 对表的物理数据页中的数据按列进行排序，然后再重新存储到磁盘上，即==聚集索引与数据是混为一体的==，它的叶节点中存储的是实际的数据
    * 采用的数据结构是B+树，不仅索引与数据在一起，并且还有指向下一个叶节点的指针。
    * 每个表只能有一个
    * 优点在于对于范围查询很有效

  * 非聚簇索引
    * 数据存储在一个地方，索引存储在另一个地方，索引带有指针指向数据的存储位置



#### Mysql索引实现方式(不同数据存储引擎)

* 第一种：**MyISAM（非聚簇索引）**
  * b+树，叶节点存索性值和数据的地址(指针)
  * **MyISAM 索引文件和数据文件是分离的**
  * 主键索引和辅助索引都指向数据存放地址，唯一区别在于主键的key唯一，辅助的可以重复

* 第二种 ：**InnoDB （聚簇索引）**
  * 同为b+树，叶节点为数据和索性值
  * 数据文件本身就是索引文件
  * 辅助索引的叶节点为主键的值
  * 搜素时要先辅助索引，然后得到主键，再主键索引

![MySQL索引实现原理分析](C:\Users\ZHW\Desktop\笔记\IMG\watermark,image_eXVuY2VzaGk=,t_100,g_se,x_0,y_0)



#### MYSQL索引的分类

* 主键索引：建表，创建主键就会顺便创建索引
* 唯一索引：值不重复
* 普通索引：无限制
* 组合索引：
  * 叶子结点存多个key
  * 遵循最左侧原则，从左到右的使用索引中的字段，一个查询可以只使用索引中的一部份，但只能是最左侧部分。例如索引是key index (a,b,c). 可以支持a ,ab ,abc 3种组合进行查找，但不支持 b,c进行查找。(使用bc，是不连续的，效率低)





## 索引的优化

- 最左前缀匹配原则，上面讲到了
- 主键外检一定要建索引
- 对 where,on,group by,order by 中出现的列使用索引
- 尽量选择区分度高的列作为索引,区分度的公式是count(distinct col)/count(*)，表示字段不重复的比例，比例越大我们扫描的记录数越少，唯一键的区分度是1，而一些状态、性别字段可能在大数据面前区分度就是0
- 对较小的数据列使用索引,这样会使索引文件更小,同时内存中也可以装载更多的索引键
- 索引列不能参与计算，保持列“干净”，比如from_unixtime(create_time) = ’2014-05-29’就不能使用到索引，原因很简单，b+树中存的都是数据表中的字段值，但进行检索时，需要把所有元素都应用函数才能比较，显然成本太大。所以语句应该写成create_time = unix_timestamp(’2014-05-29’);
- 为较长的字符串使用前缀索引
- 尽量的扩展索引，不要新建索引。比如表中已经有a的索引，现在要加(a,b)的索引，那么只需要修改原来的索引即可
- 不要过多创建索引, 权衡索引个数与DML之间关系，DML也就是插入、删除数据操作。这里需要权衡一个问题，建立索引的目的是为了提高查询效率的，但建立的索引过多，会影响插入、删除数据的速度，因为我们修改的表数据，索引也需要进行调整重建
- 对于like查询，”%”不要放在前面。
  `SELECT * FROM`houdunwang`WHERE`uname`LIKE'后盾%' -- 走索引`
  `SELECT * FROM`houdunwang`WHERE`uname`LIKE "%后盾%" -- 不走索引`
- 查询where条件数据类型不匹配也无法使用索引
  字符串与数字比较不使用索引;
  `CREATE TABLE`a`(`a`char(10));`
  `EXPLAIN SELECT * FROM`a`WHERE`a`="1"` – 走索引
  EXPLAIN SELECT * FROM `a` WHERE `a`=1 – 不走索引
  正则表达式不使用索引,这应该很好理解,所以为什么在SQL中很难看到regexp关键字的原因
  